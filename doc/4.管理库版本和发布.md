# 管理库版本和发布

这一章将告诉你如何通过Poetry安装你的程序库。

## 一.版本控制

Poetry要求所有项目都使用符合[PEP 440](https://peps.python.org/pep-0440/)标准的版本。

虽然 Poetry 不要求项目遵循特定的发布约定，但它曾经建议在 PEP 440 范围内使用[semantic versioning](https://semver.org/)，并支持适用于语义版本的版本约束。这意味着你可以选择遵循语义版本规范，同时 Poetry 提供了对符合此规范的版本约束的支持。

> 例如，1.0.0-hotfix.1 与 PEP 440 不兼容。你可以选择使用 1.0.0-post1 或 1.0.0.post1。

## 二.锁定文件

如果您愿意的话你可以将 `poetry.lock` 文件提交到版本库中。这个文件记录了项目所使用的依赖项的确切版本，这样可以确保团队在测试时都使用相同的依赖版本，从而避免因为依赖项变化导致的问题。但请注意，这个锁定文件只影响主项目，对于依赖于这个库的其他项目没有影响。

如果不想提交锁文件，而且使用了 git，可以将其添加到 `.gitignore` 中，以防止它被意外提交。

## 三.打包

在你实际发布库之前，你需要对它进行打包。

```bash
poetry build
```

这个命令将以两种不同的格式打包你的库：`sdist` 是源代码格式，而 `wheel` 是一个已编译的包。

在构建包时，Poetry会自动包含一些元数据文件。

在构建`wheel`时，这些文件将包含在 `.dist-info` 目录中，而在构建`sdist`时，这些文件将包含在根目录中

| `wheel`       | `sdist`    |
| ------------- | ---------- |
| `LICENSE`     | `LICENSE*` |
| `LICENSE.*`   |            |
| `COPYING`     |            |
| `COPYING.*`   |            |
| `LICENSES/**` |            |

一旦构建完成，你就可以准备好发布你的库了。

## 四.发布到pypi

Poetry默认会将库发布到[PyPI](https://pypi.org/)（Python Package Index）。一旦发布到PyPI的内容，Poetry会自动将其包含在可用依赖中。由于 `pendulum` 已经存在于PyPI上，我们可以在Poetry中依赖它，而不需要指定其他额外的存储库。这使得依赖管理变得更加简单，因为Poetry会自动查找PyPI上已发布的包。

如果我们希望与Python社区共享 `poetry-demo`，那么同样可以很容易地在PyPI上发布。

```bash
poetry publish
```

如果你是pypi的注册用户并且正确的配置了凭据，上面的命令就能将你打包好的包直接发布到[PyPI](https://pypi.org/).

> **注意:**
>
> 默认情况下，`publish`命令不会执行构建，如果你想一起构建和发布你的包，只需要传递`--build`选项。

一旦完成，你的库任何人都可用。

## 五.发布到私有仓库

有时你可能希望你的库是私有的，但你的团队是可以访问使用的。这个时候使用私有仓库就可以解决这个问题。为了将库发布到私有仓库，你需要将其添加到你的全局仓库列表中。相关信息请查询后续"添加仓库"章节。

一旦完成，你就可以像下面完成发布：

```bash
poetry publish -r my-repository
```

